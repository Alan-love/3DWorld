uniform float water_plane_z;

float get_water_fog_coord(in vec4 vertex, in vec3 eye, inout vec3 clipped_vert) {
	// clip the line to the water plane if the eye is above the water
	// could use different terms/fog scaling/color for inside/outside water?
	float t   = min(1.0, (eye.z - water_plane_z)/max(0.0001, (eye.z - vertex.z)));
	clipped_vert = mix(eye, vertex.xyz, ((t < 0.0) ? 1.0 : t));
	return length(clipped_vert - eye);
}
